<div class="real-estate-container">
  <div class="container mt-4">

    <h4>{{ isAdmin ? "Tüm Taşınmazlar (Admin)" : "Taşınmazlarım" }}</h4>

    <ng-container *ngIf="allEstates.length > 0; else noDataAtAll">
      
      <div class="controls">
        <div class="search-box">
          <img src="..\assets\icons\search-symbol.png" class="search-icon">
          <input
            type="text"
            placeholder="Tabloda ara..."
            [(ngModel)]="searchText"
            (input)="onSearchChange()"
          />
        </div>
      </div>

      <div class="table-container" *ngIf="estates.length > 0; else noSearchResults">
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th *ngIf="isAdmin">Kullanıcı ID</th>
              <th>İl</th>
              <th>İlçe</th>
              <th>Mahalle</th>
              <th>Alan (m²)</th>
              <th>Tarih</th>
              <th>İşlemler</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let item of estates">
              <td>{{ item.realEstateId }}</td>
              <td *ngIf="isAdmin">{{ item.userId }}</td>
              <td>{{ item.cityName || "Bilinmiyor" }}</td>
              <td>{{ item.districtName || "Bilinmiyor" }}</td>
              <td>{{ item.neighborhoodName || "Bilinmiyor" }}</td>
              <td>{{ item.area | number : "1.0-2" }}</td>
              <td>{{ item.createdDate | date : "dd.MM.yyyy" }}</td>
              <td>
                <div class="action-buttons">
                  <button class="icon-btnEdit" (click)="openEditModal(item)"><img src="\assets\icons\pencil.png" class="editBtn"></button>
                  <button class="icon-btnDelete" (click)="openDeleteModal(item)"><img src="\assets\icons\trash.png" class="deleteBtn"></button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <ng-template #noSearchResults>
        <app-empty-state
          [title]="'SONUÇ BULUNAMADI'"
          [message]="'Arama kriterlerinize uygun taşınmaz bulunamadı.'"
          [icon]="'fa-search'"
          [showButton]="false">
        </app-empty-state>
      </ng-template>

    </ng-container>

    <ng-template #noDataAtAll>
      <app-empty-state
        [title]="'TAŞINMAZ KAYDI YOK'"
        [message]="'Sistemde henüz taşınmazınız bulunmuyor. Analiz yaparak yeni bir taşınmaz eklemek ister misiniz?'"
        [icon]="'fa-map-marked-alt'"
        [buttonText]="'ANALİZ SAYFASINA GİT'"
        (actionClicked)="navigateToAnalysis()">
      </app-empty-state>
    </ng-template>

  </div>

  <app-delete-confirm-modal 
  [isOpen]="isDeleteModalOpen"
  [itemDetails]="selectedEstateForDelete"
  (onConfirm)="confirmDelete()"
  (onClose)="isDeleteModalOpen=false">

  </app-delete-confirm-modal>
  <app-edit-real-estate-modal
  *ngIf="selectedEstateForEdit"
  [isOpen]="isEditModalOpen"
  [dataEstate]="selectedEstateForEdit"
  (onSave)="confirmEdit($event)"
  (onClose)="closeEditModal()">
</app-edit-real-estate-modal>
</div>